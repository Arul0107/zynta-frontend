import{r as f,I as J,e as K,x as e,B as h,y as Y,V as u}from"./index-Dx0fORvq.js";import{i as C}from"./axios-By3bUnR1.js";import{F as i}from"./index-BHKMv-_S.js";import{F as G}from"./Table-BFHR8fXI.js";import{D as O}from"./index-C3OeHxcS.js";import{I as w}from"./index-CycGH6gG.js";import{S as j}from"./index-Bcd2XmZI.js";import{R as H}from"./EditOutlined--TcujLaX.js";import{R as Q}from"./SwapOutlined-zdS496Nn.js";import{P as W}from"./index-D4CZw55Y.js";import{R as X}from"./DeleteOutlined-DlHM_4f9.js";import"./TextArea-Bqwst6Wg.js";import"./row-D7mQAf0A.js";import"./ExclamationCircleFilled-ctPYYyzk.js";import"./styleChecker-BIxzM-w-.js";import"./addEventListener-CZDGFXVg.js";import"./index-Bq5jwgzS.js";import"./Pagination-9G_nljkd.js";import"./extendsObject-78o_rR5W.js";import"./context-LTZAWJIx.js";import"./useClosable-D6ihuouj.js";import"./ActionButton-DcYFGn3W.js";var Z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M678.3 642.4c24.2-13 51.9-20.4 81.4-20.4h.1c3 0 4.4-3.6 2.2-5.6a371.67 371.67 0 00-103.7-65.8c-.4-.2-.8-.3-1.2-.5C719.2 505 759.6 431.7 759.6 349c0-137-110.8-248-247.5-248S264.7 212 264.7 349c0 82.7 40.4 156 102.6 201.1-.4.2-.8.3-1.2.5-44.7 18.9-84.8 46-119.3 80.6a373.42 373.42 0 00-80.4 119.5A373.6 373.6 0 00137 888.8a8 8 0 008 8.2h59.9c4.3 0 7.9-3.5 8-7.8 2-77.2 32.9-149.5 87.6-204.3C357 628.2 432.2 597 512.2 597c56.7 0 111.1 15.7 158 45.1a8.1 8.1 0 008.1.3zM512.2 521c-45.8 0-88.9-17.9-121.4-50.4A171.2 171.2 0 01340.5 349c0-45.9 17.9-89.1 50.3-121.6S466.3 177 512.2 177s88.9 17.9 121.4 50.4A171.2 171.2 0 01683.9 349c0 45.9-17.9 89.1-50.3 121.6C601.1 503.1 558 521 512.2 521zM880 759h-84v-84c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v84h-84c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h84v84c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-84h84c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"user-add",theme:"outlined"},ee=function(v,g){return f.createElement(J,K({},v,{ref:g,icon:Z}))},ae=f.forwardRef(ee);const{Option:p}=j,Ce=({users:k,departments:v,teams:g,fetchUsers:I,fetchDepartments:S,fetchTeams:T,loading:R})=>{var F,E;const[N,y]=f.useState(!1),[t,D]=f.useState(null),[b]=i.useForm(),[B,_]=f.useState(!1),[d,$]=f.useState(null),[A]=i.useForm(),l=JSON.parse(localStorage.getItem("user")),o=(l==null?void 0:l.role)==="Superadmin",m=(l==null?void 0:l.role)==="Admin",x=(l==null?void 0:l.role)==="Team Leader";f.useEffect(()=>{},[]);const q=()=>{D(null),b.resetFields(),b.setFieldsValue({role:"Employee",status:"Active"}),y(!0)},L=a=>{var r,s;D(a),b.setFieldsValue({name:a.name,email:a.email,mobile:a.mobile,role:a.role,status:a.status,department:(r=a.department)==null?void 0:r._id,team:(s=a.team)==null?void 0:s._id}),y(!0)},M=async()=>{var a,r,s,c;try{const n=await b.validateFields();if(t&&!n.password&&delete n.password,x&&t){if(n.role!==t.role){u.error("Team Leaders cannot change user roles.");return}if(n.department!==((a=t.department)==null?void 0:a._id)){u.error("Team Leaders cannot change user departments.");return}if(n.team!==((r=t.team)==null?void 0:r._id)){u.error("Team Leaders cannot change user teams.");return}}t?(await C.put(`/api/users/${t._id}`,n),u.success("User updated successfully")):(await C.post("/api/users",n),u.success("User created successfully")),y(!1),I(),(o||m)&&(T(),S())}catch(n){console.error(n),u.error(((c=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:c.message)||"Failed to submit user")}},P=async a=>{var r,s;try{if((o||m)&&l._id===a){u.error("You cannot delete your own account.");return}await C.delete(`/api/users/${a}`),u.success("User deleted"),I(),(o||m)&&(T(),S())}catch(c){u.error(((s=(r=c==null?void 0:c.response)==null?void 0:r.data)==null?void 0:s.message)||"Delete failed")}},U=a=>{var r,s,c,n;$(a),A.setFieldsValue({currentDepartment:(r=a.department)==null?void 0:r.name,currentTeam:(s=a.team)==null?void 0:s.name,newDepartment:(c=a.department)==null?void 0:c._id,newTeam:(n=a.team)==null?void 0:n._id}),_(!0)},V=async()=>{var a,r;try{const s=await A.validateFields(),{newDepartment:c,newTeam:n}=s;await C.put(`/api/users/transfer/${d._id}`,{newDepartmentId:c,newTeamId:n}),u.success(`${d.name} transferred successfully`),_(!1),I(),T(),S()}catch(s){console.error("Transfer error:",s),u.error(((r=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:r.message)||"Failed to transfer user")}},z=[{title:"Name",dataIndex:"name",key:"name"},{title:"Email",dataIndex:"email",key:"email"},{title:"Mobile",dataIndex:"mobile",key:"mobile"},{title:"Role",dataIndex:"role",key:"role"},{title:"Status",dataIndex:"status",key:"status"},{title:"Department",dataIndex:"department",key:"department",render:a=>(a==null?void 0:a.name)||"N/A"},{title:"Team",dataIndex:"team",key:"team",render:a=>(a==null?void 0:a.name)||"N/A"},{title:"Actions",key:"actions",render:(a,r)=>{var s;return e.jsxs(Y,{children:[(o||m||x&&l.team===((s=r.team)==null?void 0:s._id))&&e.jsx(h,{icon:e.jsx(H,{}),onClick:()=>L(r)}),(o||m)&&e.jsx(h,{icon:e.jsx(Q,{}),onClick:()=>U(r),title:"Transfer User to another Team/Department"}),(o||m)&&e.jsx(W,{title:"Delete this user?",onConfirm:()=>P(r._id),disabled:l._id===r._id,children:e.jsx(h,{danger:!0,icon:e.jsx(X,{}),disabled:l._id===r._id})})]})}}];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx("h2",{children:"User Management"}),(o||m)&&e.jsx(h,{type:"primary",style:{backgroundColor:"#0E2B43",borderColor:"#orange",color:"white"},icon:e.jsx(ae,{}),onClick:q,children:"Create User"})]}),e.jsx(G,{columns:z,dataSource:k,loading:R,rowKey:"_id",bordered:!0}),e.jsx(O,{title:t?"Edit User":"Create User",open:N,onClose:()=>y(!1),width:420,destroyOnClose:!0,styles:{body:{paddingBottom:80}},footer:e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(h,{onClick:()=>y(!1),style:{marginRight:8},children:"Cancel"}),e.jsx(h,{type:"primary",style:{backgroundColor:"#0E2B43",borderColor:"#orange",color:"white"},onClick:M,children:t?"Update":"Create"})]}),children:e.jsxs(i,{form:b,layout:"vertical",children:[e.jsx(i.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Name is required"}],children:e.jsx(w,{disabled:x&&t&&l._id!==t._id})}),e.jsx(i.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"},{type:"email",message:"Invalid email format"}],children:e.jsx(w,{disabled:x&&t&&l._id!==t._id})}),e.jsx(i.Item,{name:"mobile",label:"Mobile",children:e.jsx(w,{disabled:x&&t&&l._id!==t._id})}),(!t&&(o||m)||t&&(o||m))&&e.jsx(i.Item,{name:"password",label:"Password",rules:t?[]:[{required:!0,message:"Password is required"}],children:e.jsx(w.Password,{placeholder:t?"Leave blank to keep current password":""})}),e.jsx(i.Item,{name:"role",label:"Role",rules:[{required:!0,message:"Please select a role"}],children:e.jsxs(j,{placeholder:"Select role",disabled:x&&t&&l._id!==t._id,children:[e.jsx(p,{value:"Superadmin",disabled:!o,children:"Superadmin"}),e.jsx(p,{value:"Admin",disabled:!o,children:"Admin"}),e.jsx(p,{value:"Team Leader",children:"Team Leader"}),e.jsx(p,{value:"Employee",children:"Employee"})]})}),e.jsx(i.Item,{name:"status",label:"Status",rules:[{required:!0,message:"Please select status"}],children:e.jsxs(j,{placeholder:"Select status",disabled:x&&t&&l._id!==t._id,children:[e.jsx(p,{value:"Active",children:"Active"}),e.jsx(p,{value:"Inactive",children:"Inactive"})]})}),(o||m)&&e.jsx(i.Item,{name:"department",label:"Department",children:e.jsx(j,{placeholder:"Select department",allowClear:!0,children:v.map(a=>e.jsx(p,{value:a._id,children:a.name},a._id))})}),(o||m)&&e.jsx(i.Item,{name:"team",label:"Team",children:e.jsx(j,{placeholder:"Select team",allowClear:!0,children:g.map(a=>{var r;return e.jsxs(p,{value:a._id,children:[a.name," (",((r=a.department)==null?void 0:r.name)||"N/A",")"]},a._id)})})})]})}),e.jsx(O,{title:`Transfer User: ${d==null?void 0:d.name}`,open:B,onClose:()=>_(!1),width:420,destroyOnClose:!0,styles:{body:{paddingBottom:80}},footer:e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(h,{onClick:()=>_(!1),style:{marginRight:8},children:"Cancel"}),e.jsx(h,{type:"primary",style:{backgroundColor:"#0E2B43",borderColor:"#orange",color:"white"},onClick:V,children:"Transfer"})]}),children:e.jsxs(i,{form:A,layout:"vertical",children:[e.jsx(i.Item,{label:"Current Department",children:e.jsx(w,{value:((F=d==null?void 0:d.department)==null?void 0:F.name)||"N/A",disabled:!0})}),e.jsx(i.Item,{label:"Current Team",children:e.jsx(w,{value:((E=d==null?void 0:d.team)==null?void 0:E.name)||"N/A",disabled:!0})}),e.jsx(i.Item,{name:"newDepartment",label:"New Department (Optional)",children:e.jsx(j,{placeholder:"Select new department",allowClear:!0,children:v.map(a=>e.jsx(p,{value:a._id,children:a.name},a._id))})}),e.jsx(i.Item,{name:"newTeam",label:"New Team (Optional)",children:e.jsx(j,{placeholder:"Select new team",allowClear:!0,children:g.map(a=>{var r;return e.jsxs(p,{value:a._id,children:[a.name," (",((r=a.department)==null?void 0:r.name)||"N/A",")"]},a._id)})})})]})})]})};export{Ce as default};
