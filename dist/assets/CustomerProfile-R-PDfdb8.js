import{I as E,u as Q,s as c,q as e}from"./index-Db3Ct3vh.js";import{r as l,K as z,B as f,T as H,E as g,au as K,C as _,O as n,e as j,v as A,av as C,b as G,L as w}from"./antd-CjRtIVzR.js";import{X as I,H as U,Y as X,Z as Y,_ as Z}from"./icons-De3RWgvB.js";import"./react-DoC2WAmd.js";const{TabPane:v}=A,{Title:d,Text:r}=H,{Panel:J}=C,O=()=>{const{id:i}=E(),p=Q(),[a,S]=l.useState(null),[D,N]=l.useState(!0),[m,L]=l.useState([]),[P,k]=l.useState([]),[T,B]=l.useState([]),[$,F]=l.useState([]);if(l.useEffect(()=>{N(!0),Promise.all([c.get(`/api/accounts/${i}`),c.get(`/api/quotations/business/${i}`),c.get(`/api/invoices/business/${i}`),c.get(`/api/accounts/${i}/followups`),c.get(`/api/invoices/business/${i}/payments`)]).then(([t,s,o,h,R])=>{S(t.data),L(s.data||[]),k(o.data||[]),B(h.data||[]),F(R.data||[])}).catch(t=>{console.error("Failed to load data:",t)}).finally(()=>N(!1))},[i]),D)return e.jsx("div",{className:"flex justify-center items-center h-screen bg-gray-50",children:e.jsx(z,{size:"large",tip:"Loading Customer Profile..."})});if(!a)return e.jsxs("div",{className:"p-6 bg-white shadow-lg rounded-lg m-6",children:[e.jsx(f,{className:"mb-4 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md transition duration-300 ease-in-out",icon:e.jsx(I,{}),onClick:()=>p("/customers"),children:"Back to Customers"}),e.jsx(d,{level:3,className:"mt-4 text-center text-gray-700",children:"Customer Not Found"}),e.jsx(g,{description:"No data found for this customer ID. It might not exist or there was an issue fetching it.",className:"mt-8"})]});const u=[...T.map(t=>({...t,type:"Follow-up",date:t.followupDate||t.date})),...(a.notes||[]).map(t=>({...t,type:"Note",date:t.timestamp}))].sort((t,s)=>new Date(s.date)-new Date(t.date)),x=t=>`₹${Number(t||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`,b=t=>{if(!t)return"N/A";try{return new Date(t).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})}catch(s){return console.error("Error formatting date:",t,s),t}},y=t=>{const s=[];return t.addressLine1&&s.push(t.addressLine1),t.addressLine2&&s.push(t.addressLine2),t.addressLine3&&s.push(t.addressLine3),t.city&&s.push(t.city),t.state&&s.push(t.state),t.pincode&&s.push(t.pincode),t.country&&s.push(t.country),s.length>0?s.join(", "):"N/A"};return P.reduce((t,s)=>t+(s.totalAmount||0),0),$.reduce((t,s)=>t+(s.amount||0),0),e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen font-sans",children:[e.jsx(f,{className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center space-x-2 customer-profile-back-button",icon:e.jsx(I,{}),onClick:()=>p(-1),children:"Back"}),e.jsx(K,{className:"mb-4 text-gray-600 mt-5 font-medium",items:[{title:"Customers",href:"/customers"},{title:a.businessName||"Profile"}]}),e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 space-y-4 sm:space-y-0",children:e.jsxs(d,{level:2,className:"text-gray-800 font-extrabold mb-0 text-center sm:text-left text-gradient-blue-purple",children:[" ",a.businessName," Profile"]})}),e.jsx(_,{title:e.jsx(d,{level:4,className:"text-gray-800 font-bold mb-0",children:"Customer Details"}),className:"shadow-xl rounded-xl mb-8 border-t-8 border-blue-600 transform hover:scale-100 transition duration-300 ease-in-out",children:e.jsxs(n,{bordered:!0,column:{xs:1,sm:2,md:2,lg:3},size:"middle",className:"text-gray-700",children:[e.jsx(n.Item,{label:e.jsx(r,{strong:!0,className:"text-gray-600",children:"Business Name"}),children:e.jsx(r,{strong:!0,className:"text-gray-900",children:a.businessName||"N/A"})}),e.jsx(n.Item,{label:e.jsx(r,{strong:!0,className:"text-gray-600",children:"GSTIN"}),children:a.gstNumber||"N/A"}),e.jsx(n.Item,{label:e.jsx(r,{strong:!0,className:"text-gray-600",children:"Customer Name"}),children:a.contactName||"N/A"}),e.jsx(n.Item,{label:e.jsx(r,{strong:!0,className:"text-gray-600",children:"Email"}),children:a.email||"N/A"}),e.jsx(n.Item,{label:e.jsx(r,{strong:!0,className:"text-gray-600",children:"Phone Number"}),children:a.phoneNumber||"N/A"}),e.jsx(n.Item,{label:e.jsx(r,{strong:!0,className:"text-gray-600",children:"Status"}),children:e.jsx(j,{color:a.status==="Active"?"green":a.status==="Inactive"?"red":"blue",className:"rounded-full px-3 py-1 text-sm font-medium",children:a.status||"N/A"})}),e.jsx(n.Item,{label:e.jsx(r,{strong:!0,className:"text-gray-600",children:"Type"}),children:a.type||"N/A"}),e.jsx(n.Item,{label:e.jsx(r,{strong:!0,className:"text-gray-600",children:"Customer Address"}),span:3,children:y(a)}),e.jsx(n.Item,{label:e.jsx(r,{strong:!0,className:"text-gray-600",children:"Created At"}),children:a.createdAt?new Date(a.createdAt).toLocaleString():"N/A"}),e.jsx(n.Item,{label:e.jsx(r,{strong:!0,className:"text-gray-600",children:"Last Updated"}),children:a.updatedAt?new Date(a.updatedAt).toLocaleString():"N/A"})]})}),e.jsxs(A,{defaultActiveKey:"1",className:"bg-white p-4 rounded-xl shadow-xl",tabBarStyle:{marginBottom:24},children:[e.jsx(v,{tab:e.jsxs("span",{className:"flex items-center space-x-2 text-lg font-semibold text-gray-700 hover:text-blue-600 transition-colors duration-200",children:[e.jsx(U,{className:"text-xl"}),e.jsxs("span",{children:["Quotations (",m.length,")"]})]}),children:m.length===0?e.jsx(g,{description:"No quotations found for this customer.",className:"py-8"}):e.jsx(C,{accordion:!0,className:"shadow-md rounded-lg overflow-hidden",expandIconPosition:"end",children:m.map((t,s)=>e.jsxs(J,{header:e.jsxs("div",{className:"font-semibold text-lg flex justify-between items-center py-2",children:[e.jsxs("span",{className:"text-gray-800",children:["Quotation #",t.quotationNumber||"N/A"]}),e.jsx("span",{className:"text-green-600 text-xl font-bold",children:x(t.totalAmount)})]}),className:"bg-white border-b border-gray-200 rounded-lg mb-2 overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-200 ease-in-out",children:[e.jsxs(n,{bordered:!0,column:{xs:1,sm:2,md:2},size:"small",className:"mb-4 text-gray-700",children:[e.jsx(n.Item,{label:e.jsx(r,{strong:!0,className:"text-gray-600",children:"Date"}),children:b(t.date)}),e.jsx(n.Item,{label:e.jsx(r,{strong:!0,className:"text-gray-600",children:"Status"}),children:e.jsx(j,{color:t.status==="Approved"?"green":t.status==="Pending"?"orange":t.status==="Rejected"?"red":"blue",className:"rounded-full px-3 py-1 text-sm font-medium",children:t.status||"N/A"})}),e.jsx(n.Item,{label:e.jsx(r,{strong:!0,className:"text-gray-600",children:"Customer Name"}),children:a.contactName||"N/A"}),e.jsx(n.Item,{label:e.jsx(r,{strong:!0,className:"text-gray-600",children:"GSTIN"}),children:a.gstNumber||"N/A"}),e.jsx(n.Item,{label:e.jsx(r,{strong:!0,className:"text-gray-600",children:"Customer Address"}),span:2,children:y(a)})]}),e.jsx(d,{level:5,className:"mt-6 mb-3 text-gray-800 font-bold",children:"Items Quoted"}),e.jsx(G,{dataSource:t.items||[],columns:[{title:"Product Name",dataIndex:"productName",key:"productName",render:o=>o||"N/A"},{title:"Description",dataIndex:"description",key:"description"},{title:"HSN/SAC",dataIndex:"hsn",key:"hsn"},{title:"Qty",dataIndex:"quantity",key:"quantity"},{title:"Rate (₹)",dataIndex:"rate",key:"rate",render:o=>x(o)},{title:"Amount (₹)",dataIndex:"amount",key:"amount",render:o=>x(o)}],pagination:!1,rowKey:(o,h)=>h,size:"small",className:"border border-gray-200 rounded-md overflow-hidden shadow-sm"})]},t._id||s))})},"1"),e.jsx(v,{tab:e.jsxs("span",{className:"flex items-center space-x-2 text-lg font-semibold text-gray-700 hover:text-blue-600 transition-colors duration-200",children:[e.jsx(Z,{className:"text-xl"}),e.jsxs("span",{children:["History (",u.length,")"]})]}),children:u.length===0?e.jsx(g,{description:"No follow-ups or notes found for this customer.",className:"py-8"}):e.jsx(w,{bordered:!0,dataSource:u,className:"rounded-lg overflow-hidden shadow-md",renderItem:t=>{var s,o;return e.jsxs(w.Item,{className:"flex flex-col items-start bg-white p-5 hover:bg-gray-50 transition-colors duration-200 border-b border-gray-200 last:border-b-0 customer-profile-list-item-hover",children:[" ",e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"font-semibold text-gray-800 text-base mb-2 flex items-center",children:[e.jsx("span",{className:"mr-3 text-blue-500 text-xl",children:t.type==="Follow-up"?e.jsx(X,{}):e.jsx(Y,{})}),e.jsxs(r,{strong:!0,children:[t.type,":"]})," ",e.jsx("span",{className:"ml-2",children:t.text||t.note||t.comment||"N/A"})]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-3 border-t border-gray-100 pt-2",children:["Added by: ",e.jsx(r,{italic:!0,children:((s=t.addedBy)==null?void 0:s.name)||((o=t.addedBy)==null?void 0:o.email)||t.author||"Unknown"})," | ",b(t.date)]})]})]})}})},"4")]})]})};export{O as default};
