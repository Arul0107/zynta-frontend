import{u as ne,q as e,s as $,V as o,A as de}from"./index-Db3Ct3vh.js";import{r as d,F as n,K as ce,N as y,B as c,C as D,m as N,n as p,an as C,$ as F,T as pe,S as l,ao as xe,y as M,e as E,z as P,D as me,P as ue,a as ge,ap as Y,c as v,l as x,M as he}from"./antd-CjRtIVzR.js";import{e as I,y as fe,J as q,K as J,L as h,w as je,M as ye,R as V,N as W,O as ve}from"./icons-De3RWgvB.js";import"./react-DoC2WAmd.js";const{Title:Ie,Text:i}=pe,{Dragger:ze}=Y,Ce=()=>{var A,T,O;const m=ne(),[s,b]=d.useState(null),[G,S]=d.useState(!0),[w,U]=d.useState(null),[H,f]=d.useState(!1),[K,B]=d.useState(!1),[R]=n.useForm(),[_,L]=d.useState(!1),[j,u]=d.useState(null),Q=()=>{const r=localStorage.getItem("user");if(r)try{return JSON.parse(r)._id}catch(t){return console.error("Error parsing user data from localStorage:",t),localStorage.removeItem("user"),null}return null},k=async()=>{const r=Q();if(!r){S(!1),m("/login");return}S(!0),U(null);try{const t=await $.get(`/api/users/${r}`);b(t.data),u(t.data.profileImage),localStorage.setItem("user",JSON.stringify(t.data))}catch(t){console.error("Error fetching user details:",t),U("Failed to load user profile.");const g=localStorage.getItem("user");if(g)try{const a=JSON.parse(g);b(a),u(a.profileImage),o.error("Failed to fetch latest data. Using cached profile.")}catch{localStorage.removeItem("user"),m("/login")}else m("/login")}finally{S(!1)}};d.useEffect(()=>{k()},[m]);const X=()=>{he.confirm({title:"Confirm Logout",content:"Are you sure you want to logout?",okText:"Yes, Logout",cancelText:"Cancel",okType:"danger",onOk:()=>{localStorage.removeItem("user"),m("/login")}})},Z=r=>(r==null?void 0:r.toLowerCase())==="active"?"success":"error",ee=r=>(r==null?void 0:r.toLowerCase())==="active"?e.jsx(V,{}):e.jsx(W,{}),se=r=>({superadmin:"red",admin:"blue",employee:"green",user:"green",manager:"orange",moderator:"purple"})[r==null?void 0:r.toLowerCase()]||"default",re=()=>{k()},te=()=>{s?(R.setFieldsValue({name:s.name,email:s.email,mobile:s.mobile||"",role:s.role,status:s.status}),u(s.profileImage),f(!0)):o.error("User data not loaded yet. Please try refreshing.")},z=async r=>{try{B(!0);const t=await $.put(`/api/users/${s._id}`,r);return b(t.data),u(t.data.profileImage),localStorage.setItem("user",JSON.stringify(t.data)),t.data}catch(t){throw console.error("Error updating profile:",t),o.error("Failed to update profile."),t}finally{B(!1)}},ae=async()=>{try{const r=await R.validateFields();r.password||delete r.password;const t={...r,profileImage:j};await z(t),o.success("Profile updated successfully!"),f(!1)}catch{}},oe=async({file:r,onSuccess:t,onError:g})=>{o.loading("Uploading image...",{id:"avatar-upload"});try{const a=await de(r);if(!(a!=null&&a.url)){o.error("Upload failed!",{id:"avatar-upload"}),g("Upload failed");return}const ie=await z({profileImage:a.url});u(ie.profileImage),o.success("Profile photo updated!",{id:"avatar-upload"}),t(a.url,r)}catch(a){console.error("Upload error:",a),o.error("Upload failed!",{id:"avatar-upload"}),g(a)}},le=async()=>{L(!0),o.loading("Removing image...",{id:"remove-avatar"});try{await z({profileImage:null}),u(null),o.success("Profile photo removed!",{id:"remove-avatar"})}catch{}finally{L(!1)}};return G?e.jsxs("div",{style:{display:"flex",justifyContent:"center",minHeight:"60vh",alignItems:"center"},children:[e.jsx(ce,{size:"large"}),w&&e.jsx(y,{message:w,type:"error",showIcon:!0})]}):s?e.jsx("div",{style:{minHeight:"100vh",padding:"40px 20px"},children:e.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto"},children:[e.jsx(D,{style:{marginBottom:"24px",borderRadius:"16px",border:"none",boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},children:e.jsxs(N,{align:"middle",gutter:24,children:[e.jsx(p,{children:e.jsx("div",{style:{position:"relative",width:80,height:80},children:s.profileImage?e.jsx(C.PreviewGroup,{items:[s.profileImage],children:e.jsx(C,{alt:`${s.name}'s profile`,width:80,height:80,src:s.profileImage,style:{borderRadius:"50%",objectFit:"cover",border:"2px solid #0E2B43"},title:"Click image to zoom"})}):e.jsx(F,{size:80,icon:e.jsx(I,{}),style:{backgroundColor:"#0E2B43",fontSize:"32px"},children:s.name?s.name.charAt(0).toUpperCase():null})})}),e.jsxs(p,{flex:"auto",children:[e.jsx(Ie,{level:2,style:{margin:0,color:"#0E2B43"},children:s.name}),e.jsx(i,{type:"secondary",style:{fontSize:"16px"},children:"Welcome back to your profile"})]}),e.jsx(p,{children:e.jsxs(l,{wrap:!0,children:[e.jsx(c,{type:"default",icon:e.jsx(xe,{}),size:"large",onClick:re,style:{borderRadius:"8px"},title:"Refresh Profile Data"}),e.jsx(c,{type:"default",icon:e.jsx(M,{}),size:"large",onClick:te,style:{borderRadius:"8px"},children:"Edit Profile"}),e.jsx(c,{type:"primary",danger:!0,icon:e.jsx(fe,{}),size:"large",onClick:X,style:{borderRadius:"8px"},children:"Logout"})]})})]})}),e.jsxs(D,{title:e.jsxs(l,{children:[e.jsx(je,{}),e.jsx("span",{children:"Profile Information"})]}),style:{borderRadius:"16px",border:"none",boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},headStyle:{borderBottom:"2px solid #f0f0f0",fontSize:"18px",fontWeight:"600",color:"#0E2B43"},children:[e.jsxs(N,{gutter:[24,24],children:[e.jsx(p,{xs:24,sm:12,children:e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx(i,{strong:!0,style:{color:"#666",fontSize:"14px",display:"block",marginBottom:"4px"},children:"FULL NAME"}),e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(I,{style:{marginRight:"8px",color:"#0E2B43"}}),e.jsx(i,{style:{fontSize:"16px"},children:s.name})]})]})}),e.jsx(p,{xs:24,sm:12,children:e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx(i,{strong:!0,style:{color:"#666",fontSize:"14px",display:"block",marginBottom:"4px"},children:"EMAIL ADDRESS"}),e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(q,{style:{marginRight:"8px",color:"#52c41a"}}),e.jsx(i,{style:{fontSize:"16px"},children:s.email})]})]})}),e.jsx(p,{xs:24,sm:12,children:e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx(i,{strong:!0,style:{color:"#666",fontSize:"14px",display:"block",marginBottom:"4px"},children:"MOBILE NUMBER"}),e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(J,{style:{marginRight:"8px",color:s.mobile?"#52c41a":"#999"}}),e.jsx(i,{style:{fontSize:"16px"},children:s.mobile||"Not provided"}),s.mobile&&e.jsx(E,{color:"success",size:"small",style:{marginLeft:"8px",borderRadius:"4px"},children:"Verified"})]})]})}),e.jsx(p,{xs:24,sm:12,children:e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx(i,{strong:!0,style:{color:"#666",fontSize:"14px",display:"block",marginBottom:"4px"},children:"ROLE"}),e.jsx("div",{style:{marginTop:"4px"},children:e.jsx(E,{icon:e.jsx(h,{}),color:se(s.role),style:{fontSize:"14px",padding:"4px 12px",borderRadius:"6px",textTransform:"capitalize"},children:s.role})})]})}),e.jsx(p,{xs:24,sm:12,children:e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx(i,{strong:!0,style:{color:"#666",fontSize:"14px",display:"block",marginBottom:"4px"},children:"STATUS"}),e.jsx("div",{style:{marginTop:"4px"},children:e.jsx(E,{icon:ee(s.status),color:Z(s.status),style:{fontSize:"14px",padding:"4px 12px",borderRadius:"6px",textTransform:"capitalize"},children:s.status})})]})})]}),e.jsx(P,{}),e.jsx("div",{style:{textAlign:"center",paddingTop:"16px"},children:e.jsxs(l,{direction:"vertical",size:4,children:[e.jsxs(i,{type:"secondary",style:{fontSize:"14px"},children:["Profile last updated:"," ",s.updatedAt?new Date(s.updatedAt).toLocaleString():new Date().toLocaleDateString()]}),w&&e.jsx(y,{message:"Connection Issue",description:"Some data may be outdated because the latest information could not be loaded from the server.",type:"warning",size:"small",showIcon:!0,style:{marginTop:"8px"}})]})})]}),e.jsx(me,{title:e.jsxs(l,{children:[e.jsx(M,{}),e.jsx("span",{children:"Edit Profile"})]}),open:H,onClose:()=>f(!1),width:480,destroyOnClose:!0,extra:e.jsxs(l,{children:[e.jsx(c,{onClick:()=>f(!1),children:"Cancel"}),e.jsx(c,{type:"primary",style:{backgroundColor:"#0E2B43",borderColor:"#0E2B43",color:"white"},icon:e.jsx(ve,{}),loading:K,onClick:ae,children:"Save Changes"})]}),children:e.jsxs(n,{form:R,layout:"vertical",requiredMark:"optional",children:[e.jsx(n.Item,{label:"Profile Picture",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"16px"},children:[j?e.jsxs("div",{style:{position:"relative"},children:[e.jsx(C,{src:j,alt:"Profile",width:100,height:100,style:{borderRadius:"50%",objectFit:"cover"}}),e.jsx(ue,{title:"Are you sure to remove your profile picture?",onConfirm:le,okText:"Yes",cancelText:"No",placement:"right",children:e.jsx(c,{type:"primary",danger:!0,shape:"circle",icon:e.jsx(ge,{}),size:"small",loading:_,style:{position:"absolute",bottom:0,right:0,zIndex:1}})})]}):e.jsx(F,{size:100,icon:e.jsx(I,{}),style:{backgroundColor:"#0E2B43",fontSize:"40px"}}),e.jsx(Y,{customRequest:oe,showUploadList:!1,accept:"image/*",style:{marginLeft:"20px"},children:e.jsx(c,{icon:e.jsx(ye,{}),style:{marginLeft:"20px"},size:"large",children:j?"Change Photo":"Upload Photo"})})]})}),e.jsx(P,{orientation:"left",style:{margin:"0 0 24px 0"},children:"Basic Info"}),e.jsx(n.Item,{name:"name",label:"Full Name",rules:[{required:!0,message:"Please enter full name"},{min:2,message:"Name must be at least 2 characters"}],children:e.jsx(v,{prefix:e.jsx(I,{}),placeholder:"Enter full name",size:"large"})}),e.jsx(n.Item,{name:"email",label:"Email Address",rules:[{required:!0,message:"Please enter email address"},{type:"email",message:"Please enter a valid email"}],children:e.jsx(v,{prefix:e.jsx(q,{}),placeholder:"Enter email address",size:"large"})}),e.jsx(n.Item,{name:"mobile",label:"Mobile Number",rules:[{pattern:/^[0-9]{10}$/,message:"Please enter a valid 10-digit mobile number"}],children:e.jsx(v,{prefix:e.jsx(J,{}),placeholder:"Enter mobile number",size:"large",style:{color:s.mobile?"#52c41a":void 0}})}),e.jsx(n.Item,{name:"password",label:"New Password (Optional)",rules:[{min:6,message:"Password must be at least 6 characters"}],children:e.jsx(v.Password,{placeholder:"Leave blank to keep current password",size:"large"})}),e.jsx(P,{orientation:"left",style:{margin:"24px 0"},children:"Access Control"}),e.jsx(n.Item,{name:"role",label:"Role",children:e.jsxs(x,{placeholder:"Select role",size:"large",disabled:((A=s==null?void 0:s.role)==null?void 0:A.toLowerCase())!=="superadmin",suffixIcon:e.jsx(h,{}),children:[e.jsx(x.Option,{value:"Superadmin",children:e.jsxs(l,{children:[e.jsx(h,{style:{color:"#ff4d4f"}}),e.jsx("span",{children:"Superadmin"})]})}),e.jsx(x.Option,{value:"Admin",children:e.jsxs(l,{children:[e.jsx(h,{style:{color:"#0E2B43"}}),e.jsx("span",{children:"Admin"})]})}),e.jsx(x.Option,{value:"Employee",children:e.jsxs(l,{children:[e.jsx(h,{style:{color:"#52c41a"}}),e.jsx("span",{children:"Employee"})]})})]})}),e.jsx(n.Item,{name:"status",label:"Status",children:e.jsxs(x,{placeholder:"Select status",size:"large",disabled:((T=s==null?void 0:s.role)==null?void 0:T.toLowerCase())!=="superadmin",children:[e.jsx(x.Option,{value:"Active",children:e.jsxs(l,{children:[e.jsx(V,{style:{color:"#52c41a"}}),e.jsx("span",{children:"Active"})]})}),e.jsx(x.Option,{value:"Inactive",children:e.jsxs(l,{children:[e.jsx(W,{style:{color:"#ff4d4f"}}),e.jsx("span",{children:"Inactive"})]})})]})}),e.jsx(y,{message:"Access Control",description:((O=s==null?void 0:s.role)==null?void 0:O.toLowerCase())!=="superadmin"?"Your **Role** and **Status** fields are locked and can only be changed by a **Superadmin** user.":"As a **Superadmin**, you can update all profile fields including role and status.",type:"info",showIcon:!0,style:{marginTop:"16px"}})]})})]})}):e.jsxs("div",{style:{padding:"40px",textAlign:"center"},children:[e.jsx(y,{message:"No User Data",description:"Could not load user profile.",type:"error",showIcon:!0}),e.jsx(c,{onClick:()=>m("/login"),style:{marginTop:"20px"},children:"Go to Login"})]})};export{Ce as default};
