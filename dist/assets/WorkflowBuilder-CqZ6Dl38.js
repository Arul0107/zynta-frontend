import{J as T,K as U,M as P,N as q,Q as D,S as F,I as L,u as J,s as b,q as s,T as K,U as Q,W as X,X as Y,V as n,Y as G}from"./index-Db3Ct3vh.js";import{r as l,j as t,c as A,B as R,M as W}from"./antd-CjRtIVzR.js";import{B as O}from"./style-Cg-PNO07.js";import"./react-DoC2WAmd.js";import"./icons-De3RWgvB.js";function Z(){return t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},t.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function ee(){return t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},t.createElement("path",{d:"M0 0h32v4.2H0z"}))}function te(){return t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},t.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function oe(){return t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},t.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function ae(){return t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},t.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const v=({children:o,className:u,...r})=>t.createElement("button",{type:"button",className:D(["react-flow__controls-button",u]),...r},o);v.displayName="ControlButton";const se=o=>({isInteractive:o.nodesDraggable||o.nodesConnectable||o.elementsSelectable,minZoomReached:o.transform[2]<=o.minZoom,maxZoomReached:o.transform[2]>=o.maxZoom}),$=({style:o,showZoom:u=!0,showFitView:r=!0,showInteractive:k=!0,fitViewOptions:w,onZoomIn:c,onZoomOut:f,onFitView:i,onInteractiveChange:d,className:x,children:N,position:p="bottom-left"})=>{const z=T(),[g,E]=l.useState(!1),{isInteractive:m,minZoomReached:h,maxZoomReached:C}=U(se,F),{zoomIn:_,zoomOut:H,fitView:M}=P();if(l.useEffect(()=>{E(!0)},[]),!g)return null;const V=()=>{_(),c==null||c()},B=()=>{H(),f==null||f()},j=()=>{M(w),i==null||i()},e=()=>{z.setState({nodesDraggable:!m,nodesConnectable:!m,elementsSelectable:!m}),d==null||d(!m)};return t.createElement(q,{className:D(["react-flow__controls",x]),position:p,style:o,"data-testid":"rf__controls"},u&&t.createElement(t.Fragment,null,t.createElement(v,{onClick:V,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:C},t.createElement(Z,null)),t.createElement(v,{onClick:B,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:h},t.createElement(ee,null))),r&&t.createElement(v,{className:"react-flow__controls-fitview",onClick:j,title:"fit view","aria-label":"fit view"},t.createElement(te,null)),k&&t.createElement(v,{className:"react-flow__controls-interactive",onClick:e,title:"toggle interactivity","aria-label":"toggle interactivity"},m?t.createElement(ae,null):t.createElement(oe,null)),N)};$.displayName="Controls";var le=l.memo($);function ue({isEdit:o}){const{service_id:u,workflow_id:r}=L(),k=J(),[w,c]=l.useState([]),[f,i]=l.useState([]),[d,x]=l.useState(""),[N,p]=l.useState(!1),[z,g]=l.useState(!1),[E,m]=l.useState(null),[h,C]=l.useState("");l.useEffect(()=>{o&&r&&b.get(`/api/workflow/single/${r}`).then(e=>{x(e.data.workflowName),c(e.data.nodes),i(e.data.edges)})},[o,r]);const _=e=>c(a=>Q(e,a)),H=e=>i(a=>X(e,a)),M=e=>i(a=>Y({...e,animated:!0},a)),V=()=>{if(!h.trim()){n.error("Enter step name!");return}c(e=>[...e,{id:crypto.randomUUID(),data:{label:h},position:{x:200,y:120+e.length*70},style:{background:"#0E2B43",color:"#fff",padding:10,borderRadius:8}}]),C(""),p(!1),n.success("Step Added!")},B=()=>{c(e=>e.filter(a=>a.id!==E.id)),i(e=>e.filter(a=>!G([E],e).map(S=>S.id).includes(a.id))),g(!1),n.success("Step Deleted!")},j=async()=>{var a,S;if(!d.trim()){n.error("Workflow name required!");return}if(!w.length){n.error("Add at least one step!");return}const e={workflowName:d,nodes:w,edges:f};try{if(o){let y=(a=(await b.put(`/api/workflow/${r}`,e)).data)==null?void 0:a.service_id;if(y||(y=(S=(await b.get(`/api/workflow/single/${r}`)).data)==null?void 0:S.service_id),!y){n.error("Service ID missing! Check backend response.");return}return n.success("Workflow Updated Successfully!"),k(`/workflow/${y}/list`)}return await b.post(`/api/workflow/${u}`,e),n.success("Workflow Created Successfully!"),k(`/workflow/${u}/list`)}catch{n.error("Failed to save workflow!")}};return s.jsxs("div",{style:{padding:20},children:[s.jsx("h2",{children:o?"Edit Workflow":"Create Workflow"}),s.jsx(A,{placeholder:"Workflow Name",value:d,onChange:e=>x(e.target.value),style:{width:280,marginBottom:10}}),s.jsx("div",{style:{height:450,border:"1px solid #ccc"},children:s.jsxs(K,{nodes:w,edges:f,onNodesChange:_,onEdgesChange:H,onConnect:M,onNodeClick:(e,a)=>{m(a),g(!0)},fitView:!0,children:[s.jsx(le,{}),s.jsx(O,{})]})}),s.jsx(R,{style:{marginTop:10},onClick:()=>p(!0),children:"+ Add Step"}),s.jsx(R,{type:"primary",danger:!0,onClick:j,style:{marginLeft:10},children:"Save Workflow"}),s.jsx(W,{open:N,onOk:V,onCancel:()=>p(!1),title:"Add Step",children:s.jsx(A,{placeholder:"Step name",value:h,onChange:e=>C(e.target.value)})}),s.jsx(W,{open:z,title:"Delete Step?",okText:"Delete",okButtonProps:{danger:!0},onOk:B,onCancel:()=>g(!1),children:"Are you sure you want to delete this step?"})]})}export{ue as default};
