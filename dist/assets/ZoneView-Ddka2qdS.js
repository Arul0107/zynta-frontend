import{r as a,x as n,S as Z,H as b}from"./index-DysXtrl7.js";import{i as c}from"./axios-Dbq_CbWC.js";import{h as z}from"./moment-C5S46NFB.js";import{C as R}from"./index-IahplJ7o.js";import{T}from"./index-CL3JxQbZ.js";import{F as _}from"./Table-DflE-h7Z.js";import{E as v}from"./index-qBajPA1p.js";import{T as F}from"./index-PWcPX8J0.js";import{D as O}from"./index-BVasZ5yH.js";import"./TextArea-Bqbh4RKI.js";import"./PlusOutlined-BIwFneT8.js";import"./styleChecker-w1bbWMN2.js";import"./addEventListener-D04I5D8z.js";import"./index-BrgBQ01W.js";import"./Pagination-ByOtUXMd.js";import"./extendsObject-78o_rR5W.js";import"./EditOutlined-C9Bhlaw5.js";import"./dayjs.min-DoBvc7g8.js";const{Title:L}=F,{TabPane:A}=T,{RangePicker:nt}=O,u="/api/accounts",rt=()=>{const[$,D]=a.useState([]),[p,f]=a.useState({}),[I,g]=a.useState(!0),[y,N]=a.useState([]),[k,x]=a.useState(!1),[i,S]=a.useState("all"),[h,P]=a.useState([]),r=JSON.parse(localStorage.getItem("user")),l=r==null?void 0:r.role,d=r==null?void 0:r._id,w=async()=>{g(!0);try{const t=await c.get("/api/zones");D(t.data);const o=await c.get(`${u}/paginated?pageSize=1000`);f(s=>({...s,all:o.data.total}));const e={};for(const s of t.data){const m=await c.get(`${u}/paginated?zone=${s._id}&pageSize=1000`);e[s._id]=m.data.total}f(s=>({...s,...e})),t.data.length>0&&S("all")}catch(t){console.error("Error fetching zones and counts:",t),b.error("Failed to load zones and counts.")}finally{g(!1)}},C=async(t,o=h)=>{x(!0);try{let e=`${u}/paginated?pageSize=1000`;if(t&&t!=="all"&&(e+=`&zone=${t}`),o&&o.length===2){const m=o[0].startOf("day").toISOString(),E=o[1].endOf("day").toISOString();e+=`&startDate=${m}&endDate=${E}`}l==="Employee"&&d&&(e+=`&userId=${d}&role=${l}`);const s=await c.get(e);N(s.data.data)}catch(e){b.error("Failed to fetch accounts."),console.error("Fetch accounts error:",e)}finally{x(!1)}};a.useEffect(()=>{w()},[]),a.useEffect(()=>{C(i)},[i,l,d,h]);const j=[{title:"Business Name",dataIndex:"businessName",key:"businessName"},{title:"Contact Name",dataIndex:"contactName",key:"contactName"},{title:"Email",dataIndex:"email",key:"email"},{title:"Mobile Number",dataIndex:"mobileNumber",key:"mobileNumber"},{title:"Status",dataIndex:"status",key:"status"},{title:"Source Type",dataIndex:"sourceType",key:"sourceType"},{title:"Created At",dataIndex:"createdAt",key:"createdAt",render:t=>z(t).format("YYYY-MM-DD HH:mm"),sorter:(t,o)=>new Date(t.createdAt)-new Date(o.createdAt)}];return n.jsxs(R,{title:n.jsx(L,{level:4,children:"Leads & Customers by Zone"}),children:[n.jsxs(T,{defaultActiveKey:"all",onChange:t=>S(t),activeKey:i,loading:I,children:[n.jsx(A,{tab:`All Zones (${p.all||0})`},"all"),$.map(t=>n.jsx(A,{tab:`${t.name} (${p[t._id]||0})`},t._id))]}),n.jsx(Z,{spinning:k,children:y.length>0?n.jsx(_,{columns:j,dataSource:y,rowKey:"_id",scroll:{x:"max-content"},pagination:!1}):n.jsx(v,{description:"No accounts found for this zone."})})]})};export{rt as default};
