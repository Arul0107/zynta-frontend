import{q as l,s as m}from"./index-Db3Ct3vh.js";import{r,D,s as a}from"./antd-CjRtIVzR.js";import{I as E,N as F}from"./InvoiceList-92xTWJQa.js";import L from"./InvoiceForm-DbSTVKKo.js";import"./react-DoC2WAmd.js";import"./icons-De3RWgvB.js";import"./moment-C5S46NFB.js";import"./html2canvas.esm-DBTO1nPv.js";const q=()=>{const[p,y]=r.useState([]),[N,d]=r.useState(!1),[t,n]=r.useState(null),[f,S]=r.useState([]),[C,h]=r.useState(!1),i=async()=>{try{const e=await m.get("/api/invoices");y(e.data)}catch{a.error("Failed to fetch invoices")}};r.useEffect(()=>{i()},[]);const x=async e=>{var c,u,s;try{console.log("Invoice data being sent:",e),t&&t._id?(await m.put(`/api/invoices/${t._id}`,e),a.success("Invoice updated successfully")):(await m.post("/api/invoices",e),a.success("Invoice created successfully")),i(),d(!1),n(null)}catch(o){console.error(o),console.error("Server error response:",(c=o==null?void 0:o.response)==null?void 0:c.data),a.error(((s=(u=o==null?void 0:o.response)==null?void 0:u.data)==null?void 0:s.message)||"Failed to save invoice")}},b=e=>{n(e),d(!0)},g=async e=>{try{await m.delete(`/api/invoices/${e}`),a.success("Invoice deleted"),i()}catch{a.error("Delete failed")}},j=e=>{const c=e.toLowerCase(),u=p.filter(s=>{var o,v,w;return((o=s==null?void 0:s.businessName)==null?void 0:o.toLowerCase().includes(c))||((v=s==null?void 0:s.invoiceNumber)==null?void 0:v.toLowerCase().includes(c))||((w=s==null?void 0:s.customerName)==null?void 0:w.toLowerCase().includes(c))});S(u)},I=()=>{d(!1),n(null)};return l.jsxs("div",{style:{},children:[l.jsx(E,{invoices:f.length>0?f:p,onAddNew:()=>{n(null),d(!0)},onEdit:b,onDelete:g,onSearch:j,refreshInvoices:i,onViewNotes:e=>{n(e),h(!0)}}),l.jsx(D,{title:t?"Edit Invoice":"Create Invoice",open:N,onClose:I,width:"80%",destroyOnClose:!0,children:l.jsx(L,{onCancel:I,onSave:x,initialValues:t||{invoiceType:"Invoice",items:[],taxRate:18,discountAmount:0,businessName:"",customerName:"",customerAddress:"",customerGSTIN:"",companyGSTIN:"",companyName:"",companyAddress:"",contactPerson:"",contactNumber:"",paymentTerms:""}})}),t&&l.jsx(F,{visible:C,onClose:()=>h(!1),invoice:t,refreshInvoices:i})]})};export{q as default};
