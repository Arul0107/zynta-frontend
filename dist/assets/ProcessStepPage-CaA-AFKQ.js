import{q as e,s as u}from"./index-Db3Ct3vh.js";import{r as m,F as n,z as S,S as T,B as d,q as w,l as f,e as F,P as R,a as I,y as $,b as q,D as G,c as x,s as c}from"./antd-CjRtIVzR.js";import"./react-DoC2WAmd.js";import"./icons-De3RWgvB.js";const{Option:N}=f;function O(){const[p,_]=m.useState([]),[h,A]=m.useState([]),[V,v]=m.useState(!1),[C,j]=m.useState(!1),[i]=n.useForm(),B=async()=>{var t;try{const s=await u.get("/api/service");A(((t=s.data)==null?void 0:t.services)||s.data||[])}catch{c.error("Failed to load services")}},y=async()=>{v(!0);try{const{data:t}=await u.get("/api/steps");_(t)}catch{c.error("Failed to load steps!")}v(!1)};m.useEffect(()=>{B(),y()},[]);const b=t=>{const s=h.find(r=>r._id===t);if(!s)return;const a=s.serviceName,o=p.find(r=>r._id===a);i.setFieldsValue({stepType:a,steps:o?o.steps:[{stepName:"",status:"Active"}],serviceId:t}),j(!0)},g=()=>{j(!1),i.resetFields()},D=async t=>{var a,o;const s=t.stepType;try{p.some(l=>l._id===s)?(await u.put(`/api/steps/${s}`,t),c.success(`Step Group ${s} Updated!`)):(await u.post("/api/steps",t),c.success("Step Group Added!")),g(),y()}catch(r){const l=((o=(a=r.response)==null?void 0:a.data)==null?void 0:o.message)||"Error while saving!";c.error(l)}},E=async t=>{try{await u.delete(`/api/steps/${t}`),c.success(`Step Group '${t}' Deleted`),y()}catch{c.error("Failed to delete step group.")}},k=[{title:"Step Name",dataIndex:"stepName"},{title:"URL/Path",dataIndex:"url",render:t=>t?e.jsx("a",{href:t,target:"_blank",rel:"noreferrer",children:t}):"-"},{title:"Status",dataIndex:"status",render:t=>e.jsx(F,{color:t==="Active"?"green":"red",children:t})},{title:"Order",dataIndex:"order",width:80}];return e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"⚙️ Process Step Templates"}),e.jsx(S,{}),e.jsxs(T,{style:{marginBottom:15},children:[e.jsx(d,{type:"primary",icon:e.jsx(w,{}),onClick:()=>{i.resetFields(),i.setFieldsValue({steps:[{stepName:"",status:"Active"}]}),j(!0)},children:"Add New Step Type Template"}),e.jsx(S,{type:"vertical"}),e.jsx(f,{placeholder:"Select Service (Step Type) to Edit",style:{width:300},onChange:b,options:h.map(t=>({label:`Edit Steps for: ${t.serviceName}`,value:t._id}))})]}),p.map(t=>{const s=h.find(o=>o.serviceName===t._id),a=s?s._id:null;return e.jsxs("div",{style:{marginBottom:"30px"},children:[e.jsxs("h3",{children:["Step Type: ",e.jsx(F,{color:"blue",style:{fontSize:16,padding:"5px 10px"},children:t._id}),e.jsx(R,{title:`Are you sure to delete the entire ${t._id} step group? This action is irreversible.`,onConfirm:()=>E(t._id),children:e.jsx(d,{size:"small",icon:e.jsx(I,{}),danger:!0,style:{marginLeft:10}})}),a&&e.jsx(d,{size:"small",icon:e.jsx($,{}),style:{marginLeft:5},onClick:()=>b(a)})]}),e.jsx(q,{rowKey:"_id",columns:k,dataSource:t.steps,pagination:!1,bordered:!0})]},t._id)}),e.jsx(G,{title:i.getFieldValue("stepType")?`Edit Template: ${i.getFieldValue("stepType")}`:"Add New Step Type Template",width:500,open:C,onClose:g,extra:e.jsxs(T,{children:[e.jsx(d,{onClick:g,children:"Cancel"}),e.jsx(d,{type:"primary",onClick:()=>i.submit(),children:p.some(t=>t._id===i.getFieldValue("stepType"))?"Update Group":"Save Group"})]}),children:e.jsxs(n,{form:i,layout:"vertical",onFinish:D,children:[e.jsx(n.Item,{name:"stepType",label:"Step Type (Service Name)",rules:[{required:!0,message:"Step Type is required"}],children:e.jsx(x,{placeholder:"Enter Service Name (e.g., Website Development)",disabled:p.some(t=>t._id===i.getFieldValue("stepType"))})}),e.jsx(S,{orientation:"left",children:"Individual Steps"}),e.jsx(n.List,{name:"steps",children:(t,{add:s,remove:a})=>e.jsxs(e.Fragment,{children:[t.map(({key:o,name:r,...l})=>e.jsxs("div",{style:{border:"1px solid #e8e8e8",padding:15,borderRadius:8,marginBottom:15,position:"relative",backgroundColor:"#fafafa"},children:[e.jsx(d,{danger:!0,size:"small",icon:e.jsx(I,{}),onClick:()=>a(r),style:{position:"absolute",top:5,right:5}}),e.jsx(n.Item,{...l,name:[r,"stepName"],label:"Step Name",rules:[{required:!0,message:"Step Name is required"}],style:{marginBottom:10},children:e.jsx(x,{placeholder:"e.g., Initial Client Brief"})}),e.jsx(n.Item,{...l,name:[r,"url"],label:"Related URL",style:{marginBottom:10},children:e.jsx(x,{placeholder:"/brief-template"})}),e.jsx(n.Item,{...l,name:[r,"description"],label:"Description",style:{marginBottom:10},children:e.jsx(x.TextArea,{rows:1,placeholder:"Brief description of the step"})}),e.jsx(n.Item,{...l,name:[r,"status"],label:"Status",initialValue:"Active",rules:[{required:!0,message:"Status is required"}],style:{marginBottom:0},children:e.jsxs(f,{children:[e.jsx(N,{value:"Active",children:"Active"}),e.jsx(N,{value:"Inactive",children:"Inactive"})]})})]},o)),e.jsx(d,{type:"dashed",onClick:()=>s({status:"Active"}),block:!0,icon:e.jsx(w,{}),children:"Add Step Row"})]})})]})})]})}export{O as default};
