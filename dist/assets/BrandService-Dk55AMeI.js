import{q as e,s as N,V as m,u as q}from"./index-Db3Ct3vh.js";import{F as c,r as d,D,c as C,Q as A,al as E,B as h,K as U,T as z,S as T,L as k,e as P,P as O,a0 as M,v as Y,q as K,b as _,O as F,V as B,x as V,y as H,a as G,av as J}from"./antd-CjRtIVzR.js";import{d as Q,u as W,a1 as X}from"./icons-De3RWgvB.js";import"./react-DoC2WAmd.js";const Z=({visible:b,onClose:w,initialValues:s,onSave:u})=>{const[a]=c.useForm();d.useEffect(()=>{s?a.setFieldsValue(s):a.resetFields()},[s]);const r=async o=>{try{s!=null&&s._id?(await N.put(`/api/service/${s._id}`,o),m.success("Service updated")):(await N.post("/api/service",o),m.success("Service created")),u(),w()}catch{m.error("Failed to save")}};return e.jsx(D,{open:b,width:500,onClose:w,title:s?"Edit Service":"Add Service",children:e.jsxs(c,{layout:"vertical",form:a,onFinish:r,children:[e.jsx(c.Item,{name:"serviceName",label:"Service Name",rules:[{required:!0}],children:e.jsx(C,{})}),e.jsx(c.Item,{name:"category",label:"Category",children:e.jsx(C,{})}),e.jsx(c.Item,{name:"basePrice",label:"Base Price",children:e.jsx(A,{min:0,style:{width:"100%"}})}),e.jsx(c.Item,{name:"description",label:"Description",children:e.jsx(C.TextArea,{rows:3})}),e.jsx(c.Item,{name:"isActive",label:"Active",valuePropName:"checked",children:e.jsx(E,{defaultChecked:!0})}),e.jsx(h,{type:"primary",htmlType:"submit",block:!0,children:s?"Update":"Create"})]})})},{TextArea:ee}=C,{Title:te,Text:se}=z,re=({visible:b,onClose:w,product:s,refreshProducts:u})=>{const[a]=c.useForm(),[r,o]=d.useState(!1),[j,y]=d.useState([]);d.useEffect(()=>{y((s==null?void 0:s.notes)||[])},[s]);const x=()=>{try{const n=JSON.parse(localStorage.getItem("user"));return(n==null?void 0:n.email)||"Unknown"}catch{return"Unknown"}},v=async n=>{try{o(!0);const p=m.loading("Adding note..."),g={text:n.note,timestamp:new Date().toLocaleString(),author:x()},i=[...j,g];await N.put(`/api/product/${s._id}/notes`,{notes:i}),y(i),m.success("Note added",{id:p}),a.resetFields(),u()}catch{m.error("Failed to add note")}finally{o(!1)}},f=()=>j.length?j.map((n,p)=>{const g=p>0?j[p-1]:null,i=new Date(n.timestamp).toDateString(),l=g?new Date(g.timestamp).toDateString():null,I=i!==l;return e.jsxs("div",{children:[I&&e.jsx("div",{className:"note-date-header",children:i}),e.jsxs("div",{className:"note-bubble",children:[e.jsxs("div",{className:"note-meta",children:[n.author,"    ",n.timestamp]}),e.jsx("div",{className:"note-text",children:n.text})]})]},p)}):e.jsx(se,{type:"secondary",children:"No notes added yet"});return e.jsx(D,{title:e.jsxs(te,{level:4,style:{margin:0},children:["Notes for Product: ",s==null?void 0:s.productName]}),open:b,onClose:w,width:440,destroyOnClose:!0,children:e.jsxs(U,{spinning:r,children:[e.jsx("div",{style:{maxHeight:460,overflowY:"auto",marginBottom:16},children:f()}),e.jsxs(c,{form:a,layout:"vertical",onFinish:v,children:[e.jsx(c.Item,{name:"note",rules:[{required:!0,message:"Please enter a note"}],children:e.jsx(ee,{rows:3,placeholder:"Type your note here"})}),e.jsx(h,{type:"primary",style:{backgroundColor:"#0E2B43",borderColor:"#orange",color:"white"},htmlType:"submit",loading:r,block:!0,icon:e.jsx(Q,{}),children:"Add Note"})]})]})})},ie=({visible:b,onClose:w,service:s,refreshServices:u})=>{const[a]=c.useForm(),[r,o]=d.useState(null),[j,y]=d.useState(!1),[x,v]=d.useState([]),[f,n]=d.useState("");if(d.useEffect(()=>{r?(a.setFieldsValue({name:r.name,priceMonthly:r.priceMonthly,priceYearly:r.priceYearly,priceOneTime:r.priceOneTime,scriptBased:r.scriptBased}),v(r.features||[])):(a.resetFields(),v([]))},[r]),!s)return null;const p=()=>{if(f.trim()){if(x.find(t=>t.name===f.trim()))return m.error("Feature already added");v([...x,{name:f.trim()}]),n("")}},g=t=>{v(x.filter(S=>S.name!==t))},i=()=>{a.resetFields(),o(null),v([]),w()},l=async t=>{try{y(!0);const S={name:t.name,priceMonthly:t.priceMonthly||0,priceYearly:t.priceYearly||0,priceOneTime:t.priceOneTime||0,scriptBased:t.scriptBased||!1,features:x};r?(await N.put(`/api/service/${s._id}/plans/${r._id}`,S),m.success("Plan updated")):(await N.post(`/api/service/${s._id}/plans`,S),m.success("Plan added")),i(),u()}catch{m.error("Failed to save plan")}finally{y(!1)}},I=async t=>{try{y(!0),await N.delete(`/api/service/${s._id}/plans/${t}`),m.success("Plan deleted"),i(),u()}catch{m.error("Failed to delete plan")}finally{y(!1)}};return e.jsxs(D,{title:`Manage Plans — ${s.serviceName}`,width:650,open:b,onClose:i,destroyOnClose:!0,children:[e.jsxs(T,{style:{width:"100%",justifyContent:"space-between"},children:[e.jsx("h3",{style:{margin:0},children:"Existing Plans"}),e.jsx(h,{type:"primary",onClick:()=>o(null),children:"New Plan"})]}),e.jsx(k,{dataSource:s.plans||[],bordered:!0,style:{margin:"16px 0"},renderItem:t=>{var S;return e.jsx(k.Item,{actions:[e.jsx(h,{size:"small",onClick:()=>o(t),children:"Edit"}),e.jsx(O,{title:"Delete this plan?",onConfirm:()=>I(t._id),children:e.jsx(h,{danger:!0,size:"small",children:"Delete"})})],children:e.jsx(k.Item.Meta,{title:e.jsxs(T,{children:[t.name,t.scriptBased&&e.jsx(P,{color:"purple",children:"Script Based"})]}),description:e.jsxs(e.Fragment,{children:["Monthly: ",t.priceMonthly?`₹${t.priceMonthly}`:"-"," | Yearly: ",t.priceYearly?`₹${t.priceYearly}`:"-"," | One Time: ",t.priceOneTime?`₹${t.priceOneTime}`:"-"," ",e.jsx("br",{}),(S=t.features)==null?void 0:S.map((R,L)=>e.jsx(P,{children:R.name},L))]})})})}}),e.jsx("h3",{children:r?"Edit Plan":"Create Plan"}),e.jsxs(c,{layout:"vertical",form:a,onFinish:l,children:[e.jsx(c.Item,{name:"name",label:"Plan Name",rules:[{required:!0}],children:e.jsx(C,{placeholder:"Basic, Premium, Gold..."})}),e.jsx(c.Item,{name:"priceMonthly",label:"Monthly Price",children:e.jsx(A,{style:{width:"100%"},min:0})}),e.jsx(c.Item,{name:"priceYearly",label:"Yearly Price",children:e.jsx(A,{style:{width:"100%"},min:0})}),e.jsx(c.Item,{name:"priceOneTime",label:"One-Time Price",children:e.jsx(A,{style:{width:"100%"},min:0})}),e.jsx(c.Item,{name:"scriptBased",label:"Script Based Automation?",valuePropName:"checked",children:e.jsx(E,{})}),e.jsx("h4",{children:"Features"}),e.jsxs(T,{style:{marginBottom:10},children:[e.jsx(C,{placeholder:"Enter feature",value:f,onChange:t=>n(t.target.value),style:{width:280}}),e.jsx(h,{type:"primary",onClick:p,children:"Add"})]}),e.jsx("div",{style:{marginBottom:20},children:x.length?x.map((t,S)=>e.jsx(P,{closable:!0,onClose:()=>g(t.name),style:{padding:"6px",marginBottom:5},children:t.name},S)):e.jsx("p",{style:{opacity:.5},children:"No features added"})}),e.jsx(h,{type:"primary",htmlType:"submit",block:!0,loading:j,children:r?"Update Plan":"Add Plan"})]})]})},{Content:ne,Header:ae}=M,{TabPane:$}=Y,{Panel:me}=J,he=()=>{const[b,w]=d.useState([]),[s,u]=d.useState(!1),[a,r]=d.useState(null),[o,j]=d.useState(null),[y,x]=d.useState(!1),[v,f]=d.useState(!1);q();const n=async()=>{try{const{data:i}=await N.get("/api/service");w(i)}catch{m.error("Failed to load Services")}};d.useEffect(()=>{n()},[]);const p=()=>n(),g=()=>[{title:"S.No",render:(i,l,I)=>I+1,width:60},{title:"Name",dataIndex:"serviceName",width:180},{title:"Status",width:100,render:(i,l)=>l.isActive?e.jsx(P,{color:"green",children:"Active"}):e.jsx(P,{color:"red",children:"Inactive"})},{title:"Plans",width:200,render:(i,l)=>{var I;return(I=l.plans)!=null&&I.length?e.jsxs(T,{wrap:!0,children:[l.plans.slice(0,3).map(t=>e.jsx(P,{children:t.name},t._id)),l.plans.length>3&&e.jsxs(P,{children:["+",l.plans.length-3," more"]})]}):e.jsx(P,{children:"No Plans"})}},{title:"Actions",width:350,render:(i,l)=>e.jsxs(T,{children:[e.jsx(B,{title:"View",children:e.jsx(h,{type:"text",icon:e.jsx(V,{}),onClick:()=>j(l)})}),e.jsx(B,{title:"Edit",children:e.jsx(h,{type:"text",icon:e.jsx(H,{}),onClick:()=>{r(l),u(!0)}})}),e.jsx(B,{title:"Notes",children:e.jsx(h,{type:"text",icon:e.jsx(W,{}),onClick:()=>{r(l),x(!0)}})}),e.jsx(B,{title:"Plans",children:e.jsx(h,{type:"text",icon:e.jsx(X,{}),onClick:()=>{r(l),f(!0)}})}),e.jsx(O,{title:"Delete service?",onConfirm:async()=>{await N.delete(`/api/service/${l._id}`),n(),m.success("Service deleted")},children:e.jsx(h,{type:"text",danger:!0,icon:e.jsx(G,{})})})]})}];return e.jsxs(M,{style:{minHeight:"100vh",background:"#fff"},children:[e.jsx(ae,{style:{background:"#fff",padding:"12px 20px"},children:e.jsx("h2",{style:{marginBottom:0},children:"Brand Service Management"})}),e.jsxs(ne,{style:{padding:20},children:[e.jsxs(Y,{defaultActiveKey:"1",children:[e.jsxs($,{tab:"Active Services",children:[e.jsx(h,{type:"primary",icon:e.jsx(K,{}),style:{marginBottom:16,background:"#0E2B43",borderColor:"#0E2B43"},onClick:()=>{r(null),u(!0)},children:"Add Service"}),e.jsx(_,{columns:g(),dataSource:b.filter(i=>i.isActive),rowKey:"_id",pagination:{pageSize:10},scroll:{x:1100}})]},"1"),e.jsx($,{tab:"Inactive Services",children:e.jsx(_,{columns:g(),dataSource:b.filter(i=>!i.isActive),rowKey:"_id",pagination:{pageSize:10},scroll:{x:1100}})},"2")]}),e.jsx(Z,{visible:s,onClose:()=>{r(null),u(!1)},onSave:p,initialValues:a}),e.jsx(D,{open:!!o,title:"Service Details",onClose:()=>j(null),width:700,children:o&&e.jsxs(F,{bordered:!0,column:1,children:[e.jsx(F.Item,{label:"Service ID",children:o.service_id}),e.jsx(F.Item,{label:"Name",children:o.serviceName}),e.jsx(F.Item,{label:"Description",children:o.description}),e.jsx(F.Item,{label:"Status",children:o.isActive?"Active":"Inactive"})]})}),a&&e.jsx(re,{visible:y,onClose:()=>x(!1),service:a,refreshServices:n}),a&&e.jsx(ie,{visible:v,onClose:()=>f(!1),service:a,refreshServices:n})]})]})};export{he as default};
