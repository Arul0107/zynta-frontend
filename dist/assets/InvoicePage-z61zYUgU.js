import{r as i,x as m}from"./index-Dx0fORvq.js";import{i as d}from"./axios-By3bUnR1.js";import{I as D,N as E}from"./InvoiceList-DYeu_p5w.js";import F from"./InvoiceForm-KdhqKnYt.js";import{D as L}from"./index-C3OeHxcS.js";import{s as c}from"./index-BuX0WK-i.js";import"./xlsx-CyWl6TWy.js";import"./index-BHKMv-_S.js";import"./TextArea-Bqwst6Wg.js";import"./row-D7mQAf0A.js";import"./ExclamationCircleFilled-ctPYYyzk.js";import"./index-CycGH6gG.js";import"./SendOutlined-DEl5XmWx.js";import"./index-DkVdE_3I.js";import"./EditOutlined--TcujLaX.js";import"./styleChecker-BIxzM-w-.js";import"./index-Bcd2XmZI.js";import"./index-gtlyNNxV.js";import"./index-B8wKftBc.js";import"./Table-BFHR8fXI.js";import"./addEventListener-CZDGFXVg.js";import"./index-Bq5jwgzS.js";import"./Pagination-9G_nljkd.js";import"./extendsObject-78o_rR5W.js";import"./index-Cdvz5H4l.js";import"./InfoCircleFilled-CGhkVSDg.js";import"./ActionButton-DcYFGn3W.js";import"./index-o4REvhBZ.js";import"./useClosable-D6ihuouj.js";import"./context-LTZAWJIx.js";import"./index-D4CZw55Y.js";import"./moment-C5S46NFB.js";import"./index-toTrP2vq.js";import"./index-CGWGFuT9.js";import"./PlusOutlined-Dt2q3nHd.js";import"./index-D5gtJ-xG.js";import"./html2canvas.esm-BSE4e0vj.js";import"./index-C1eVaR1v.js";import"./index-BGnsSyBi.js";import"./PrinterOutlined-Bf2hBR8h.js";import"./MessageOutlined-B6KeS4ko.js";import"./ScheduleOutlined-B90A6p-T.js";import"./DeleteOutlined-DlHM_4f9.js";import"./index-CJ2clCQa.js";import"./index-DmCauXk3.js";import"./MinusCircleOutlined-CncFMDVt.js";import"./SaveOutlined-BPE7Lej8.js";const be=()=>{const[u,y]=i.useState([]),[N,p]=i.useState(!1),[s,a]=i.useState(null),[f,S]=i.useState([]),[x,h]=i.useState(!1),n=async()=>{try{const e=await d.get("/api/invoices");y(e.data)}catch{c.error("Failed to fetch invoices")}};i.useEffect(()=>{n()},[]);const C=async e=>{var r,l,o;try{console.log("Invoice data being sent:",e),s&&s._id?(await d.put(`/api/invoices/${s._id}`,e),c.success("Invoice updated successfully")):(await d.post("/api/invoices",e),c.success("Invoice created successfully")),n(),p(!1),a(null)}catch(t){console.error(t),console.error("Server error response:",(r=t==null?void 0:t.response)==null?void 0:r.data),c.error(((o=(l=t==null?void 0:t.response)==null?void 0:l.data)==null?void 0:o.message)||"Failed to save invoice")}},b=e=>{a(e),p(!0)},g=async e=>{try{await d.delete(`/api/invoices/${e}`),c.success("Invoice deleted"),n()}catch{c.error("Delete failed")}},j=e=>{const r=e.toLowerCase(),l=u.filter(o=>{var t,v,w;return((t=o==null?void 0:o.businessName)==null?void 0:t.toLowerCase().includes(r))||((v=o==null?void 0:o.invoiceNumber)==null?void 0:v.toLowerCase().includes(r))||((w=o==null?void 0:o.customerName)==null?void 0:w.toLowerCase().includes(r))});S(l)},I=()=>{p(!1),a(null)};return m.jsxs("div",{style:{},children:[m.jsx(D,{invoices:f.length>0?f:u,onAddNew:()=>{a(null),p(!0)},onEdit:b,onDelete:g,onSearch:j,refreshInvoices:n,onViewNotes:e=>{a(e),h(!0)}}),m.jsx(L,{title:s?"Edit Invoice":"Create Invoice",open:N,onClose:I,width:"80%",destroyOnClose:!0,children:m.jsx(F,{onCancel:I,onSave:C,initialValues:s||{invoiceType:"Invoice",items:[],taxRate:18,discountAmount:0,businessName:"",customerName:"",customerAddress:"",customerGSTIN:"",companyGSTIN:"",companyName:"",companyAddress:"",contactPerson:"",contactNumber:"",paymentTerms:""}})}),s&&m.jsx(E,{visible:x,onClose:()=>h(!1),invoice:s,refreshInvoices:n})]})};export{be as default};
