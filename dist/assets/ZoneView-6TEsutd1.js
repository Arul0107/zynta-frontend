import{q as n,s as r,B as b}from"./index-Db3Ct3vh.js";import{r as a,C as Z,v as $,K as z,b as R,E as _,T as v,o as O}from"./antd-CjRtIVzR.js";import{h as F}from"./moment-C5S46NFB.js";import"./react-DoC2WAmd.js";import"./icons-De3RWgvB.js";const{Title:K}=v,{TabPane:A}=$,{RangePicker:H}=O,m="/api/accounts",q=()=>{const[I,N]=a.useState([]),[p,f]=a.useState({}),[T,g]=a.useState(!0),[y,k]=a.useState([]),[w,x]=a.useState(!1),[i,S]=a.useState("all"),[h,L]=a.useState([]),c=JSON.parse(localStorage.getItem("user")),l=c==null?void 0:c.role,d=c==null?void 0:c._id,C=async()=>{g(!0);try{const t=await r.get("/api/zones");N(t.data);const s=await r.get(`${m}/paginated?pageSize=1000`);f(o=>({...o,all:s.data.total}));const e={};for(const o of t.data){const u=await r.get(`${m}/paginated?zone=${o._id}&pageSize=1000`);e[o._id]=u.data.total}f(o=>({...o,...e})),t.data.length>0&&S("all")}catch(t){console.error("Error fetching zones and counts:",t),b.error("Failed to load zones and counts.")}finally{g(!1)}},D=async(t,s=h)=>{x(!0);try{let e=`${m}/paginated?pageSize=1000`;if(t&&t!=="all"&&(e+=`&zone=${t}`),s&&s.length===2){const u=s[0].startOf("day").toISOString(),E=s[1].endOf("day").toISOString();e+=`&startDate=${u}&endDate=${E}`}l==="Employee"&&d&&(e+=`&userId=${d}&role=${l}`);const o=await r.get(e);k(o.data.data)}catch(e){b.error("Failed to fetch accounts."),console.error("Fetch accounts error:",e)}finally{x(!1)}};a.useEffect(()=>{C()},[]),a.useEffect(()=>{D(i)},[i,l,d,h]);const j=[{title:"Business Name",dataIndex:"businessName",key:"businessName"},{title:"Contact Name",dataIndex:"contactName",key:"contactName"},{title:"Email",dataIndex:"email",key:"email"},{title:"Mobile Number",dataIndex:"mobileNumber",key:"mobileNumber"},{title:"Status",dataIndex:"status",key:"status"},{title:"Source Type",dataIndex:"sourceType",key:"sourceType"},{title:"Created At",dataIndex:"createdAt",key:"createdAt",render:t=>F(t).format("DD-MM-YYYY HH:mm"),sorter:(t,s)=>new Date(t.createdAt)-new Date(s.createdAt)}];return n.jsxs(Z,{title:n.jsx(K,{level:4,children:"Leads & Customers by Zone"}),children:[n.jsxs($,{defaultActiveKey:"all",onChange:t=>S(t),activeKey:i,loading:T,children:[n.jsx(A,{tab:`All Zones (${p.all||0})`},"all"),I.map(t=>n.jsx(A,{tab:`${t.name} (${p[t._id]||0})`},t._id))]}),n.jsx(z,{spinning:w,children:y.length>0?n.jsx(R,{columns:j,dataSource:y,rowKey:"_id",scroll:{x:"max-content"},pagination:!1}):n.jsx(_,{description:"No accounts found for this zone."})})]})};export{q as default};
