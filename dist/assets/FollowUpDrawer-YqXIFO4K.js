import{r as l,I as O,e as $,x as e,S as Y,B as D,H as f,E as q}from"./index-CzhUO-j-.js";import{i as F}from"./axios-By3bUnR1.js";import{F as r}from"./index-BvPXtaWX.js";import{D as k}from"./index-DMNwR-Br.js";import{R as C,C as d}from"./row-OZxQAKlt.js";import{I as a}from"./index-DhqNJc9P.js";import{S as N}from"./index-C8yeWvpE.js";import{T as U}from"./index-C4h5jtsp.js";import{R as G}from"./MinusCircleOutlined-BeXN-Bnu.js";import{R as H}from"./PlusOutlined-DZ7SDzrR.js";import{T as W}from"./index-DJDzaHKa.js";import{D as M}from"./index-DQBNl5Vo.js";import{h as L}from"./moment-C5S46NFB.js";import{D as J,e as Q}from"./index-mKLDrSdO.js";import{L as z}from"./index-lr-WlZcr.js";import{R as Z}from"./MessageOutlined-GNJpu7hy.js";var K={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 128c-212.1 0-384 171.9-384 384v360c0 13.3 10.7 24 24 24h184c35.3 0 64-28.7 64-64V624c0-35.3-28.7-64-64-64H200v-48c0-172.3 139.7-312 312-312s312 139.7 312 312v48H688c-35.3 0-64 28.7-64 64v208c0 35.3 28.7 64 64 64h184c13.3 0 24-10.7 24-24V512c0-212.1-171.9-384-384-384zM328 632v192H200V632h128zm496 192H696V632h128v192z"}}]},name:"customer-service",theme:"outlined"},X=function(u,t){return l.createElement(O,$({},u,{ref:t,icon:K}))},Ce=l.forwardRef(X),V={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM514.1 580.1l-61.8-102.4c-2.2-3.6-6.1-5.8-10.3-5.8h-38.4c-2.3 0-4.5.6-6.4 1.9-5.6 3.5-7.3 10.9-3.7 16.6l82.3 130.4-83.4 132.8a12.04 12.04 0 0010.2 18.4h34.5c4.2 0 8-2.2 10.2-5.7L510 664.8l62.3 101.4c2.2 3.6 6.1 5.7 10.2 5.7H620c2.3 0 4.5-.7 6.5-1.9 5.6-3.6 7.2-11 3.6-16.6l-84-130.4 85.3-132.5a12.04 12.04 0 00-10.1-18.5h-35.7c-4.2 0-8.1 2.2-10.3 5.8l-61.2 102.3z"}}]},name:"file-excel",theme:"outlined"},ee=function(u,t){return l.createElement(O,$({},u,{ref:t,icon:V}))},Ne=l.forwardRef(ee),te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M531.3 574.4l.3-1.4c5.8-23.9 13.1-53.7 7.4-80.7-3.8-21.3-19.5-29.6-32.9-30.2-15.8-.7-29.9 8.3-33.4 21.4-6.6 24-.7 56.8 10.1 98.6-13.6 32.4-35.3 79.5-51.2 107.5-29.6 15.3-69.3 38.9-75.2 68.7-1.2 5.5.2 12.5 3.5 18.8 3.7 7 9.6 12.4 16.5 15 3 1.1 6.6 2 10.8 2 17.6 0 46.1-14.2 84.1-79.4 5.8-1.9 11.8-3.9 17.6-5.9 27.2-9.2 55.4-18.8 80.9-23.1 28.2 15.1 60.3 24.8 82.1 24.8 21.6 0 30.1-12.8 33.3-20.5 5.6-13.5 2.9-30.5-6.2-39.6-13.2-13-45.3-16.4-95.3-10.2-24.6-15-40.7-35.4-52.4-65.8zM421.6 726.3c-13.9 20.2-24.4 30.3-30.1 34.7 6.7-12.3 19.8-25.3 30.1-34.7zm87.6-235.5c5.2 8.9 4.5 35.8.5 49.4-4.9-19.9-5.6-48.1-2.7-51.4.8.1 1.5.7 2.2 2zm-1.6 120.5c10.7 18.5 24.2 34.4 39.1 46.2-21.6 4.9-41.3 13-58.9 20.2-4.2 1.7-8.3 3.4-12.3 5 13.3-24.1 24.4-51.4 32.1-71.4zm155.6 65.5c.1.2.2.5-.4.9h-.2l-.2.3c-.8.5-9 5.3-44.3-8.6 40.6-1.9 45 7.3 45.1 7.4zm191.4-388.2L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z"}}]},name:"file-pdf",theme:"outlined"},se=function(u,t){return l.createElement(O,$({},u,{ref:t,icon:te}))},Fe=l.forwardRef(se);const{TextArea:re}=a,{Option:n}=N,{Title:le}=U,Ae=({visible:i,onClose:u,initialValues:t,allUsers:y=[],allZones:w=[],loadingUsers:v=!1})=>{const[m]=r.useForm(),[p,S]=l.useState(!1),[b,A]=l.useState([]),[I,o]=l.useState(!1),[j,g]=l.useState(y),T=null;l.useEffect(()=>{i&&(async()=>{o(!0);try{const c=await F.get("/api/service");A(c.data)}catch(c){console.error(c),f.error("Failed to load services")}finally{o(!1)}})()},[i]),l.useEffect(()=>{var s;m.resetFields(),t?m.setFieldsValue({...t,selectedService:((s=t.selectedService)==null?void 0:s._id)||null}):m.setFieldsValue({sourceType:"Direct",status:"Active",selectedService:null,assignedTo:null,typeOfLead:[],additionalContactPersons:[]})},[t,m]),l.useEffect(()=>{g(y)},[T,y]);const E=async()=>{try{const s=await m.validateFields();S(!0);const c=new Date().toLocaleString(),x=s.noteInput?{text:s.noteInput,timestamp:c,author:"User"}:null,P=x?[...(t==null?void 0:t.notes)||[],x]:(t==null?void 0:t.notes)||[],h={...s,notes:P,selectedService:s.selectedService};delete h.noteInput,t!=null&&t._id?(await F.put(`/api/accounts/${t._id}`,h),f.success("Account updated successfully!")):(await F.post("/api/accounts",h),f.success("Account created successfully!")),u()}catch(s){console.error(s),f.error("Failed to save account."),s.response&&s.response.status===409&&f.error(s.response.data.message||"Business name already exists.")}finally{S(!1)}};return e.jsx(k,{title:t?"Edit Business Account":"Create New Business Account",width:850,onClose:u,open:i,styles:{body:{paddingBottom:80}},footer:e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(D,{onClick:u,style:{marginRight:8},children:"Cancel"}),e.jsx(D,{type:"primary",loading:p,onClick:E,style:{backgroundColor:"#0E2B43",borderColor:"orange",color:"white"},children:t?"Update Account":"Create Account"})]}),children:e.jsx(Y,{spinning:v||I,children:e.jsxs(r,{form:m,layout:"vertical",children:[e.jsxs(C,{gutter:16,children:[e.jsx(d,{span:12,children:e.jsx(r.Item,{name:"businessName",label:"Business Name",rules:[{required:!0,message:"Please enter business name"}],children:e.jsx(a,{})})}),e.jsx(d,{span:12,children:e.jsx(r.Item,{name:"gstNumber",label:"GST Number",children:e.jsx(a,{})})})]}),e.jsxs(C,{gutter:16,children:[e.jsx(d,{span:12,children:e.jsx(r.Item,{name:"contactName",label:"Primary Contact Name",rules:[{required:!0,message:"Please enter contact name"}],children:e.jsx(a,{})})}),e.jsx(d,{span:12,children:e.jsx(r.Item,{name:"contactEmail",label:"Email",children:e.jsx(a,{})})})]}),e.jsxs(C,{gutter:16,children:[e.jsx(d,{span:12,children:e.jsx(r.Item,{name:"contactNumber",label:"Mobile Number",rules:[{required:!0,message:"Please enter mobile number"}],children:e.jsx(a,{})})}),e.jsx(d,{span:12,children:e.jsx(r.Item,{name:"typeOfLead",label:"Type of Leads",children:e.jsxs(N,{mode:"multiple",allowClear:!0,children:[e.jsx(n,{value:"Regular",children:"Regular"}),e.jsx(n,{value:"Revenue",children:"Revenue"}),e.jsx(n,{value:"Government",children:"Government"}),e.jsx(n,{value:"Occupational",children:"Occupational"})]})})})]}),e.jsx("div",{style:{marginBottom:16},children:e.jsx(le,{level:5,children:"Additional Contact Persons"})}),e.jsx(r.List,{name:"additionalContactPersons",children:(s,{add:c,remove:x})=>e.jsxs(e.Fragment,{children:[s.map(({key:P,name:h,...R})=>e.jsxs("div",{style:{border:"1px solid #d9d9d9",padding:16,marginBottom:16,borderRadius:8},children:[e.jsxs(C,{gutter:16,align:"baseline",children:[e.jsx(d,{span:11,children:e.jsx(r.Item,{...R,label:"Name",name:[h,"name"],children:e.jsx(a,{})})}),e.jsx(d,{span:11,children:e.jsx(r.Item,{...R,label:"Email",name:[h,"email"],children:e.jsx(a,{})})}),e.jsx(d,{span:2,style:{display:"flex",justifyContent:"flex-end",alignItems:"center"},children:e.jsx(G,{onClick:()=>x(h)})})]}),e.jsx(C,{gutter:16,children:e.jsx(d,{span:11,children:e.jsx(r.Item,{...R,label:"Phone",name:[h,"phoneNumber"],children:e.jsx(a,{})})})})]},P)),e.jsx(r.Item,{children:e.jsx(D,{type:"dashed",onClick:c,block:!0,icon:e.jsx(H,{}),children:"Add Additional Contact"})})]})}),e.jsxs(C,{gutter:16,children:[e.jsx(d,{span:12,children:e.jsx(r.Item,{name:"addressLine1",label:"Address Line 1",children:e.jsx(a,{})})}),e.jsx(d,{span:12,children:e.jsx(r.Item,{name:"addressLine2",label:"Address Line 2",children:e.jsx(a,{})})})]}),e.jsxs(C,{gutter:16,children:[e.jsx(d,{span:8,children:e.jsx(r.Item,{name:"city",label:"City",children:e.jsx(a,{})})}),e.jsx(d,{span:8,children:e.jsx(r.Item,{name:"pincode",label:"Pincode",children:e.jsx(W,{style:{width:"100%"}})})}),e.jsx(d,{span:8,children:e.jsx(r.Item,{name:"state",label:"State",children:e.jsx(a,{})})})]}),e.jsx(r.Item,{name:"country",label:"Country",children:e.jsx(a,{})}),e.jsx(r.Item,{name:"website",label:"Website URL",children:e.jsx(a,{})}),e.jsx(r.Item,{name:"type",label:"Lead Type",children:e.jsxs(N,{placeholder:"Select Type",children:[e.jsx(n,{value:"Hot",children:"Hot"}),e.jsx(n,{value:"Warm",children:"Warm"}),e.jsx(n,{value:"Cold",children:"Cold"})]})}),e.jsx(r.Item,{name:"status",label:"Account Status",rules:[{required:!0,message:"Please select account status"}],children:e.jsxs(N,{placeholder:"Select Status",children:[e.jsx(n,{value:"Active",children:"Active"}),e.jsx(n,{value:"Pipeline",children:"Pipeline"}),e.jsx(n,{value:"Quotations",children:"Quotations"}),e.jsx(n,{value:"Customer",children:"Customer"}),e.jsx(n,{value:"Closed",children:"Closed"}),e.jsx(n,{value:"TargetLeads",children:"Target Leads"})," "]})}),e.jsx(r.Item,{name:"sourceType",label:"Source Type",children:e.jsxs(N,{placeholder:"Select Source",children:[e.jsx(n,{value:"Direct",children:"Direct"}),e.jsx(n,{value:"socialmedia",children:"Social Media"}),e.jsx(n,{value:"online",children:"Website"}),e.jsx(n,{value:"client",children:"Existing Client"}),e.jsx(n,{value:"tradefair",children:"Tradefair"}),e.jsx(n,{value:"Other",children:"Other"})]})}),e.jsx(r.Item,{name:"assignedTo",label:"Assigned To",children:e.jsx(N,{placeholder:"Select a user",allowClear:!0,showSearch:!0,optionFilterProp:"children",children:j.map(s=>e.jsxs(n,{value:s._id,children:[s.name," (",s.role,")"]},s._id))})}),e.jsx(r.Item,{name:"selectedService",label:"Select Service",children:e.jsx(N,{placeholder:"Select a service",allowClear:!0,loading:I,showSearch:!0,optionFilterProp:"children",children:b.map(s=>e.jsx(n,{value:s._id,children:s.serviceName},s._id))})}),e.jsx(r.Item,{name:"noteInput",label:"Add Note",children:e.jsx(re,{rows:3,placeholder:"Add a note"})})]})})})},{TextArea:ne}=a,{Title:oe,Text:ae}=U,Te=({visible:i,onClose:u,account:t,refreshAccounts:y})=>{const[w]=r.useForm(),[v,m]=l.useState(!1),[p,S]=l.useState([]);l.useEffect(()=>{i&&(t!=null&&t._id)&&S(t.notes||[])},[i,t]);const b=()=>{try{const o=JSON.parse(localStorage.getItem("user"));return(o==null?void 0:o.email)||"Unknown"}catch{return"Unknown"}},A=async()=>{try{const{note:o}=await w.validateFields();m(!0);const j={text:o,timestamp:new Date().toLocaleString(),author:b()},g=[...p,j];await F.put(`/api/accounts/${t._id}`,{...t,notes:g}),f.success("Note added successfully!"),S(g),w.resetFields(),y()}catch{f.error("Failed to add note.")}finally{m(!1)}},I=()=>!p||p.length===0?e.jsx(ae,{type:"secondary",children:"No notes to show"}):p.map((o,j)=>{const g=j>0?p[j-1]:null,T=new Date(o.timestamp).toDateString(),E=g?new Date(g.timestamp).toDateString():null,s=T!==E;return e.jsxs("div",{children:[s&&e.jsx("div",{className:"note-date-header",children:T}),e.jsxs("div",{className:"note-bubble",children:[e.jsxs("div",{className:"note-meta",children:[o.author,"    ",o.timestamp]}),e.jsx("div",{className:"note-text",children:o.text})]})]},j)});return e.jsxs(k,{title:e.jsxs(oe,{level:4,style:{margin:0},children:["Notes for ",t.businessName]}),open:i,onClose:u,width:440,bodyStyle:{padding:"24px"},destroyOnClose:!0,children:[I(),e.jsx(M,{}),e.jsxs(r,{form:w,layout:"vertical",children:[e.jsx(r.Item,{name:"note",label:"Add Note",rules:[{required:!0,message:"Please enter a note"}],children:e.jsx(ne,{rows:3,placeholder:"Type your note here...",disabled:v})}),e.jsx(D,{type:"primary",style:{backgroundColor:"#0E2B43",borderColor:"#orange",color:"white"},icon:e.jsx(H,{}),onClick:A,loading:v,block:!0,children:"Add Note"})]})]})},{TextArea:ce}=a,{Text:B}=U,Re=({visible:i,onClose:u,account:t,refreshAccounts:y})=>{const[w,v]=l.useState(""),[m,p]=l.useState(null),[S,b]=l.useState(!1),[A,I]=l.useState([]),[o,j]=l.useState(null);l.useEffect(()=>{i&&(t!=null&&t._id)?g():(I([]),j(null),v(""),p(null))},[i,t]);const g=async()=>{if(t!=null&&t._id){b(!0);try{const s=await F.get(`/api/accounts/${t._id}/followups`);I(s.data.sort((c,x)=>L(x.createdAt).diff(L(c.createdAt)))||[])}catch(s){console.error("Error fetching follow-ups:",s),f.error("Failed to fetch follow-ups")}finally{b(!1)}}},T=()=>{if(!w.trim()||!m){f.error("Please select a date and enter a note for the follow-up.");return}const s=JSON.parse(localStorage.getItem("user")),c=s==null?void 0:s._id;if(!c){f.error("User information not found. Please log in.");return}b(!0);const x={date:m.toISOString(),note:w.trim(),addedBy:c};(o===null?F.post(`/api/accounts/${t._id}/followups`,x):F.put(`/api/accounts/${t._id}/followups/${o._id}`,x)).then(()=>{f.success(o===null?"Follow-up added successfully!":"Follow-up updated successfully!"),v(""),p(null),j(null),g(),typeof y=="function"&&y()}).catch(h=>{var R,_;console.error("Error saving follow-up:",h),f.error(((_=(R=h==null?void 0:h.response)==null?void 0:R.data)==null?void 0:_.message)||"Failed to save follow-up.")}).finally(()=>b(!1))},E=s=>{var c,x;return e.jsx(z.Item,{children:e.jsxs("div",{style:{backgroundColor:"#f0f2f5",borderRadius:"12px",padding:"10px 15px",maxWidth:"calc(100% - 80px)",flexGrow:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"5px"},children:[e.jsx(q,{style:{marginRight:"5px",color:"#888"}}),e.jsx(B,{strong:!0,style:{marginRight:"10px",color:"#333"},children:((c=s.addedBy)==null?void 0:c.name)||((x=s.addedBy)==null?void 0:x.email)||"Unknown User"}),e.jsx(Q,{style:{marginRight:"5px",color:"#888"}}),e.jsxs(B,{type:"secondary",style:{fontSize:"0.8em"},children:[L(s.createdAt).format("DD/MM/YYYY, h:mm:ss A")," "]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"flex-start"},children:[e.jsx(Z,{style:{marginRight:"8px",marginTop:"3px",color:"#555"}}),e.jsx(B,{style:{flexGrow:1},children:s.note})]})]})})};return e.jsxs(k,{title:`Follow-ups for Account: ${(t==null?void 0:t.businessName)||"N/A"}`,open:i,onClose:()=>{j(null),v(""),p(null),u()},width:720,children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx(J,{style:{width:"100%",marginBottom:8},format:"DD-MM-YYYY",value:m,onChange:s=>p(s),placeholder:"Select follow-up date"}),e.jsx(ce,{rows:4,placeholder:"Enter follow-up note",value:w,onChange:s=>v(s.target.value)}),e.jsx(D,{type:"primary",style:{marginTop:10,backgroundColor:"#0E2B43",borderColor:"#0E2B43",color:"white"},block:!0,onClick:T,loading:S,children:o===null?"Add Follow-up":"Update Follow-up"})]}),e.jsxs(M,{children:["All Follow-ups (",A.length,")"]}),e.jsx(z,{dataSource:A,renderItem:E,locale:{emptyText:"No follow-ups found for this account."},style:{marginTop:16}})]})};export{Ae as B,Re as F,Te as N,Fe as R,Ne as a,Ce as b};
