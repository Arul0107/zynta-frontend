import{q as e,s as m,V as o}from"./index-Db3Ct3vh.js";import{r as D,F as p,B as i,q as I,b as E,D as v,c as B,S as R,y as q,P as A,a as O}from"./antd-CjRtIVzR.js";import"./react-DoC2WAmd.js";import"./icons-De3RWgvB.js";const M=({departments:f,fetchDepartments:u,fetchTeams:x,fetchUsers:y})=>{const[C,n]=D.useState(!1),[l,g]=D.useState(null),[c]=p.useForm(),r=JSON.parse(localStorage.getItem("user")),j=(r==null?void 0:r.role)==="Superadmin",h=(r==null?void 0:r.role)==="Admin",w=()=>{g(null),c.resetFields(),n(!0)},F=a=>{g(a),c.setFieldsValue({name:a.name,description:a.description}),n(!0)},b=async()=>{var a,s;try{const t=await c.validateFields();l?(await m.put(`/api/departments/${l._id}`,t),o.success("Department updated successfully")):(await m.post("/api/departments",t),o.success("Department created successfully")),n(!1),u(),x(),y()}catch(t){console.error(t),o.error(((s=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to submit department")}},S=async a=>{var s,t;try{await m.delete(`/api/departments/${a}`),o.success("Department deleted"),u(),x(),y()}catch(d){o.error(((t=(s=d==null?void 0:d.response)==null?void 0:s.data)==null?void 0:t.message)||"Delete failed")}},k=[{title:"Name",dataIndex:"name",key:"name"},{title:"Actions",key:"actions",render:(a,s)=>e.jsx(R,{children:(j||h)&&e.jsxs(e.Fragment,{children:[e.jsx(i,{icon:e.jsx(q,{}),onClick:()=>F(s)}),e.jsx(A,{title:"Delete this department?",onConfirm:()=>S(s._id),children:e.jsx(i,{danger:!0,icon:e.jsx(O,{})})})]})})}];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx("h2",{children:"Department Management"}),(j||h)&&e.jsx(i,{type:"primary",style:{backgroundColor:"#0E2B43",borderColor:"#orange",color:"white"},icon:e.jsx(I,{}),onClick:w,children:"Create Department"})]}),e.jsx(E,{columns:k,dataSource:f,rowKey:"_id",bordered:!0}),e.jsx(v,{title:l?"Edit Department":"Create Department",open:C,onClose:()=>n(!1),width:420,destroyOnClose:!0,footer:e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(i,{onClick:()=>n(!1),style:{marginRight:8},children:"Cancel"}),e.jsx(i,{type:"primary",style:{backgroundColor:"#0E2B43",borderColor:"#orange",color:"white"},onClick:b,children:l?"Update":"Create"})]}),children:e.jsx(p,{form:c,layout:"vertical",children:e.jsx(p.Item,{name:"name",label:"Department Name",rules:[{required:!0,message:"Department name is required"}],children:e.jsx(B,{})})})})]})};export{M as default};
